schemaVersion: v0.2
prepare:
  steps:
    - name: update Nix version
      command: curl -L https://nixos.org/nix/install | sh
    - name: install kubectl
      command: nix-env -iA nixpkgs.kubectl nixpkgs.kubelogin-oidc
    - name: install gardenlogin
      command: ./install_gardenlogin.sh
    - name: install dependencies
      command: npm install
test:
  steps:
    - name: run tests
      command: npm test
run:
  api:
    steps:
      - name: deploy api endpoints
        command: NODE_ENV=development npm start
    plan: 101
    replicas: 1
    isPublic: true
    network:
      path: /api
      stripPath: true
