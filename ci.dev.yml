schemaVersion: v0.2
prepare:
  steps:
    - name: install NodeJS 24
      command: nix-env -iA nixpkgs.nodejs_24
    - name: install kubectl
      command: nix-env -iA nixpkgs.kubectl nixpkgs.kubelogin-oidc
    - name: install gardenlogin
      command: ./install_gardenlogin.sh
    - name: install node dependencies
      command: pnpm install
test:
  steps:
    - name: run tests
      command: pnpm run test
run:
  api:
    steps:
      - name: check env vars
        command: 'echo "$KUBECONFIG - $GL_HOME" '
      - name: run
        command: pnpm run dev
    plan: 101
    replicas: 1
    isPublic: true
    network:
      path: /api/v1/kubernetes
      stripPath: false
